# 修正・拡張機能仕様書

## 概要

AI開発請負システムで作成されたプロジェクトに対して、完成後の修正要望や機能追加に対応するための機能仕様です。継続的な改善とメンテナンスを可能にします。

## 現状の課題

1. **修正要望への対応困難**
   - PR作成後の修正要望に対する標準的な対応方法がない
   - 新規プロジェクトとして作り直す必要がある

2. **機能追加の非効率性**
   - 既存プロジェクトへの機能追加ができない
   - コードの再利用が困難

3. **継続的改善の欠如**
   - 一度完成したプロジェクトの改善サイクルがない
   - ユーザーフィードバックを反映する仕組みがない

## 解決策

### A. PR段階での修正対応

#### 1. 修正要望の受付方法

**GitHubでの修正依頼：**
```markdown
@claude 以下の修正をお願いします：
- ボタンの色を青から緑に変更
- ログイン画面にパスワード忘れリンクを追加
- エラーメッセージを日本語化
```

**Slackでの修正依頼：**
```
/revise-dev 42 "ボタンの色を緑に変更、ログイン画面の改善"
```

#### 2. Claude Codeの動作

1. **修正依頼の認識**
   - PRコメントの `@claude` メンションを検出
   - 修正内容を解析

2. **同一ブランチでの作業継続**
   - 新しいブランチは作成しない
   - 既存のコードベースに修正を適用

3. **修正完了の報告**
   ```markdown
   ✅ 修正を完了しました
   
   ### 変更内容
   - ボタンの色を緑に変更 (styles.css: L45)
   - パスワード忘れリンクを追加 (login.jsx: L78-82)
   - エラーメッセージを日本語化 (messages.js)
   
   ### 確認方法
   1. npm run dev で起動
   2. ログイン画面で確認
   
   追加の修正があればお知らせください。
   ```

### B. マージ後の機能追加

#### 1. 新コマンド: /add-feature

**コマンド形式：**
```
/add-feature [元のIssue番号] "[追加機能の説明]" [予算（省略可）] [期限（省略可）]
```

**使用例：**
```
/add-feature 42 "ユーザープロフィール機能を追加" 50万円 1週間
/add-feature 35 "CSV出力機能を追加"
```

#### 2. 処理フロー

1. **元プロジェクトの特定**
   - Issue番号から元のプロジェクトを特定
   - 関連するコードとブランチを確認

2. **新規Issueの作成**
   ```markdown
   ## 機能追加依頼
   
   ### 元のプロジェクト
   - Issue: #42 (ECサイト構築)
   - ブランチ: claude/issue-42-20240710
   
   ### 追加機能
   ユーザープロフィール機能
   
   ### 要件
   - プロフィール画像のアップロード
   - 自己紹介文の編集
   - 公開/非公開の設定
   
   ### 技術的考慮事項
   既存の認証システムと統合
   
   @claude 上記の機能を追加してください。
   ```

3. **Claude Codeの動作**
   - 元のコードを理解
   - 新規ブランチを作成: `claude/issue-42-add-profile`
   - 追加機能のみを実装
   - 小規模なPRを作成

### C. 継続的改善フロー

#### 1. バグ修正

**専用コマンド：**
```
/fix-bug [Issue番号] "[バグの説明]"
```

**処理：**
- 緊急度の高いバグ修正
- ホットフィックスブランチの作成
- 最小限の変更で修正

#### 2. パフォーマンス改善

**専用コマンド：**
```
/improve-performance [Issue番号] "[改善対象]"
```

**処理：**
- パフォーマンス分析
- ボトルネックの特定
- 最適化の実施

## 実装詳細

### n8nワークフローの追加

#### ワークフロー: 修正要望処理

```yaml
name: 修正要望処理システム
trigger: 
  - Slack Slash Command (/revise-dev)
  - GitHub Webhook (PR comment)
actions:
  1. 修正内容の解析
  2. 対象PRの特定
  3. GitHubコメントの追加（@claude メンション付き）
  4. 進捗追跡
  5. 完了通知
```

#### ワークフロー: 機能追加処理

```yaml
name: 機能追加システム
trigger: Slack Slash Command (/add-feature)
actions:
  1. 元プロジェクトの情報取得
  2. 新規Issue作成
  3. 技術仕様の生成（AI Agent）
  4. Claude Code起動
  5. 進捗モニタリング
```

### データ構造

#### 修正要望管理

```json
{
  "revision_request": {
    "id": "rev-001",
    "pr_number": 42,
    "requested_by": "user123",
    "request_time": "2024-07-11T10:00:00Z",
    "changes": [
      {
        "type": "ui_change",
        "description": "ボタンの色を緑に変更",
        "status": "completed"
      },
      {
        "type": "feature_add", 
        "description": "パスワード忘れリンク追加",
        "status": "in_progress"
      }
    ],
    "claude_responses": []
  }
}
```

#### 機能追加管理

```json
{
  "feature_addition": {
    "id": "feat-001",
    "parent_issue": 42,
    "new_issue": 58,
    "feature": "ユーザープロフィール機能",
    "branch": "claude/issue-42-add-profile",
    "status": "in_development",
    "created_at": "2024-07-11T10:00:00Z",
    "estimated_hours": 8
  }
}
```

## 期待される効果

1. **開発の継続性**
   - プロジェクト完成後も改善可能
   - ユーザーニーズへの迅速な対応

2. **効率的な機能追加**
   - 既存コードの再利用
   - 小規模な変更で価値を追加

3. **品質の向上**
   - バグの迅速な修正
   - 継続的な改善サイクル

## セキュリティ考慮事項

1. **権限管理**
   - 修正要望は元のプロジェクト作成者のみ可能
   - Slackユーザーとの紐付け

2. **変更の追跡**
   - 全ての変更を記録
   - 監査ログの保持

3. **スコープ制限**
   - 大規模な変更は新規プロジェクトとして扱う
   - 修正は軽微なものに限定

## 運用ルール

1. **修正要望の基準**
   - UIの調整、バグ修正、小機能追加まで
   - アーキテクチャ変更は新規プロジェクト

2. **レスポンスタイム**
   - 修正要望: 即座に対応開始
   - 機能追加: 通常の開発フローに従う

3. **コミュニケーション**
   - 進捗を定期的に報告
   - 不明点は都度確認