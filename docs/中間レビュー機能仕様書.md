# 中間レビュー機能仕様書

## 概要

AI開発請負システムにおいて、Claude Codeが開発を進める際に、適切なタイミングでユーザーレビューを挟むことで、成果物の品質向上と手戻りの削減を実現する機能です。

## 現状の課題

1. **一方通行の開発プロセス**
   - Claude Codeが開発を開始すると、完成まで一切のユーザーインタラクションがない
   - 途中で方向性の確認や修正ができない

2. **完成後の大幅修正リスク**
   - 完成してから「思っていたものと違う」となる可能性
   - 大幅な手戻りが発生する恐れ

3. **ユーザーの不安**
   - 開発進捗が見えない
   - 期待通りのものができているか確認できない

## 解決策：マイルストーン方式

### 開発フェーズの定義

開発プロセスを4つのフェーズに分割し、各フェーズの終了時にレビューポイントを設けます。

#### Phase 1: 設計レビュー（進捗20%）

**内容：**
- 技術スタックの選定
- アーキテクチャ設計
- 画面設計（UIのある場合）
- 主要機能の実装計画

**成果物：**
```markdown
## 設計書

### 技術スタック
- フロントエンド: React 18 + TypeScript
- バックエンド: Node.js + Express
- データベース: PostgreSQL
- スタイリング: Tailwind CSS

### アーキテクチャ
[アーキテクチャ図]

### 画面設計
[ワイヤーフレーム]

### 実装計画
1. 認証機能
2. ダッシュボード
3. データ管理機能
```

**レビュー内容：**
- 技術選定の妥当性
- 要件との整合性
- 実現可能性

#### Phase 2: MVP レビュー（進捗50%）

**内容：**
- 基本機能の実装
- 最小限動作するバージョン
- 主要な画面とフローの確認

**成果物：**
- 動作するアプリケーション（基本機能のみ）
- スクリーンショット or デモ動画
- 実装済み機能リスト

**レビュー内容：**
- 基本的な動作確認
- UIの使いやすさ
- 機能の過不足

#### Phase 3: 最終レビュー（進捗80%）

**内容：**
- 全機能の実装完了
- エラーハンドリング
- 基本的なテスト

**成果物：**
- ほぼ完成版のアプリケーション
- テスト結果
- 残タスクリスト

**レビュー内容：**
- 品質の確認
- 細かい調整要望
- リリース可否の判断

#### Phase 4: 完成（進捗100%）

**内容：**
- 全ての要望を反映
- ドキュメント完成
- PR作成

## 実装方法

### Claude Codeの振る舞い

1. **自動停止機能**
   ```yaml
   custom_instructions: |
     各フェーズ完了時に自動的に停止し、
     PRコメントでレビューを依頼する
   ```

2. **進捗報告フォーマット**
   ```markdown
   ## 📊 進捗報告: Phase 1 完了（20%）
   
   ### 完了内容
   - 設計書作成完了
   - 技術スタック決定
   
   ### レビュー依頼事項
   - アーキテクチャの妥当性
   - 技術選定について
   
   ### 次のステップ
   Phase 2: MVP実装（基本機能の開発）
   
   @claude-review-needed
   ```

3. **ユーザー応答の待機**
   - `@claude continue` - 次のフェーズへ進む
   - `@claude revise: [フィードバック]` - 修正を実施

### GitHubでの実装

1. **ラベルによる状態管理**
   - `phase-1-design` - 設計フェーズ
   - `phase-2-mvp` - MVP開発フェーズ
   - `phase-3-final` - 最終調整フェーズ
   - `review-needed` - レビュー待ち
   - `in-progress` - 作業中

2. **PRコメントでのやり取り**
   ```
   Claude Code: "Phase 1完了しました。設計書をご確認ください"
   ユーザー: "@claude revise: データベースをMySQLに変更してください"
   Claude Code: "承知しました。MySQLに変更します"
   ```

### n8nワークフローの追加

#### ワークフロー1: GitHub PR監視

**トリガー：** GitHub Webhook (PR comment created)

**処理フロー：**
1. コメント内容を解析
2. `@claude-review-needed` タグを検出
3. Slackに通知を送信
4. ユーザーの応答を記録

**Slack通知フォーマット：**
```
🔔 レビューが必要です

プロジェクト: ECサイト構築
フェーズ: Phase 1 - 設計レビュー
PR: #42

設計書が完成しました。以下をご確認ください：
- 技術スタック
- アーキテクチャ
- 実装計画

GitHubで確認: [リンク]
承認する場合: /continue-dev 42
修正依頼: /revise-dev 42 "修正内容"
```

## 期待される効果

1. **品質向上**
   - 早期のフィードバックにより、手戻りを削減
   - ユーザーの期待に沿った成果物

2. **透明性の向上**
   - 開発進捗の可視化
   - ユーザーの安心感

3. **コミュニケーション改善**
   - 定期的な確認ポイント
   - 双方向のやり取り

## 移行計画

1. **Phase 1（1週目）**
   - Claude Codeのカスタム指示を更新
   - 基本的なレビューフローをテスト

2. **Phase 2（2週目）**
   - n8nワークフローを追加
   - Slack通知を実装

3. **Phase 3（3週目）**
   - 本番運用開始
   - フィードバックを収集して改善