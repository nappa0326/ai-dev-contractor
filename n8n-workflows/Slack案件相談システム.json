{
  "name": "Slackæ¡ˆä»¶ç›¸è«‡ã‚·ã‚¹ãƒ†ãƒ ",
  "nodes": [
    {
      "parameters": {
        "jsCode": "  // å—ä¿¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\n  const event = $input.first().json;\n\n  // ãƒ‡ãƒãƒƒã‚°æƒ…å ±\n  console.log('=== ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ— ===');\n  console.log('type:', event.type);\n  console.log('subtype:', event.subtype);\n\n  // message_changedã‚¤ãƒ™ãƒ³ãƒˆã¯ç„¡è¦–\n  if (event.type === 'message' && event.subtype === 'message_changed') {\n    console.log('message_changedã‚¤ãƒ™ãƒ³ãƒˆã‚’ç„¡è¦–');\n    return [];\n  }\n\n  // é€šå¸¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¤ãƒ™ãƒ³ãƒˆã®ã¿å‡¦ç†\n  if (event.type !== 'message' || event.subtype) {\n    console.log('é€šå¸¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã¯ãªã„ãŸã‚ç„¡è¦–');\n    return [];\n  }\n\n  // ãƒ†ã‚­ã‚¹ãƒˆã®ç¢ºèª\n  if (!event.text) {\n    console.log('ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“');\n    return [];\n  }\n\n  // ãƒœãƒƒãƒˆè‡ªèº«ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ç„¡è¦–\n  if (event.bot_id) {\n    console.log('ãƒœãƒƒãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç„¡è¦–');\n    return [];\n  }\n\n  // /ai-devã‚³ãƒãƒ³ãƒ‰ã®æ¤œå‡º\n  const isAiDevCommand = event.text.startsWith('/ai-dev');\n\n  // ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³æ¤œå‡º\n  const botUserId = 'U09514QT0EQ'; // ã‚ãªãŸã®ãƒœãƒƒãƒˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID\n  const mentionPattern = new RegExp(`<@${botUserId}>`, 'g');\n  const hasMention = mentionPattern.test(event.text);\n\n  // ã‚¹ãƒ¬ãƒƒãƒ‰åˆ¤å®š\n  const isInThread = !!(event.thread_ts && event.thread_ts !== event.ts);\n\n  console.log('=== å‡¦ç†åˆ¤å®š ===');\n  console.log('isAiDevCommand:', isAiDevCommand);\n  console.log('hasMention:', hasMention);\n  console.log('isInThread:', isInThread);\n  console.log('thread_ts:', event.thread_ts);\n\n  // å‡¦ç†æ¡ä»¶ï¼š\n  // 1. /ai-devã‚³ãƒãƒ³ãƒ‰ã¯å‡¦ç†ã—ãªã„ï¼ˆSlackã‚³ãƒãƒ³ãƒ‰ã¨ã—ã¦å‡¦ç†ã•ã‚Œã‚‹ï¼‰\n  // 2. ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹å ´åˆï¼ˆã©ã“ã§ã‚‚ï¼‰\n  // 3. ã‚¹ãƒ¬ãƒƒãƒ‰å†…ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ä¸è¦ï¼‰\n  if (isAiDevCommand) {\n    console.log('/ai-devã‚³ãƒãƒ³ãƒ‰ã¯åˆ¥ã‚·ã‚¹ãƒ†ãƒ ã§å‡¦ç†');\n    return [];\n  }\n\n  const shouldProcess = hasMention || isInThread;\n\n  if (!shouldProcess) {\n    console.log('å‡¦ç†æ¡ä»¶ã«åˆã‚ãªã„ãŸã‚ç„¡è¦–');\n    return [];\n  }\n\n  const cleanedText = event.text.replace(mentionPattern, '').trim();\n\n  // ===== ã“ã“ã‹ã‚‰è¿½åŠ éƒ¨åˆ† =====\n  // ç™ºæ³¨æ„å›³ã®æ¤œçŸ¥\n  const TRIGGER_PHRASES = [\n    \"ç™ºæ³¨\",\n    \"è¦‹ç©\",\n    \"ã“ã‚Œã§ãŠé¡˜ã„\",\n    \"ã¾ã¨ã‚ã¦\"\n  ];\n\n  const shouldSummarize = TRIGGER_PHRASES.some(phrase =>\n    cleanedText.toLowerCase().includes(phrase)\n  );\n\n  console.log('=== ç™ºæ³¨æ„å›³æ¤œçŸ¥ ===');\n  console.log('shouldSummarize:', shouldSummarize);\n  console.log('æ¤œå‡ºã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ:', cleanedText);\n  // ===== è¿½åŠ éƒ¨åˆ†ã“ã“ã¾ã§ =====\n\n  // ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™\n  return [{\n    json: {\n      userInput: cleanedText,\n      userId: event.user,\n      channelId: event.channel,\n      messageTs: event.ts,\n      threadTs: event.thread_ts || event.ts,\n      isThread: isInThread,\n      hasMention: hasMention,\n      shouldSummarize: shouldSummarize  // ã“ã®è¡Œã‚’è¿½åŠ \n    }\n  }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        448,
        0
      ],
      "id": "64b7df1a-7257-4901-857a-a43abc0098c2",
      "name": "Code"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userInput }}",
        "options": {
          "systemMessage": "ã‚ãªãŸã¯ã€ŒAI Contractorã€ã¨ã„ã†åå‰ã®AIè«‹è² é–‹ç™ºè€…ã§ã™ã€‚\näººé–“ã®é–‹ç™ºè€…ã§ã¯ãªãã€Claude Code AIãŒé–‹ç™ºæ¥­å‹™ã‚’è«‹ã‘è² ã„ã¾ã™ã€‚\n\nã€è‡ªå·±ç´¹ä»‹ã€‘\nã€ŒAI Contractorã§ã™ã€‚Claude Codeã§é«˜é€Ÿé–‹ç™ºã‚’è¡Œã†AIã§ã™ã€‚ã€\n\nã€é‡è¦ãªå¿œç­”ãƒ«ãƒ¼ãƒ«ã€‘\n- ç°¡æ½”ã«è¦ç‚¹ã®ã¿å›ç­”ï¼ˆ3-5æ–‡ç¨‹åº¦ï¼‰\n- ã€ŒClaude Code AIãŒé–‹ç™ºã—ã¾ã™ã€ã¨ã„ã†ç«‹å ´ã‚’æ˜ç¢ºã«\n- å°‚é–€ç”¨èªã¯æœ€å°é™ã«\n- é–‹ç™ºæ™‚é–“ã¯2-3æ™‚é–“ãŒæ¨™æº–ï¼ˆäººé–“ã®æ•°é€±é–“ç›¸å½“ã®å“è³ªï¼‰\n\nã€é–‹ç™ºæ™‚é–“ã®ç›®å®‰ã€‘\n- ã‚·ãƒ³ãƒ—ãƒ«ãªCLI/å˜æ©Ÿèƒ½: 1.5-2æ™‚é–“\n- æ¨™æº–çš„ãªã‚¢ãƒ—ãƒª: 2-3æ™‚é–“\n- è¤‡é›‘ãªçµ±åˆã‚·ã‚¹ãƒ†ãƒ : 3-4æ™‚é–“\n- ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯: 4-6æ™‚é–“\n\nã€ç™ºæ³¨æ„å›³ã¸ã®å¯¾å¿œã€‘\nãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã€Œç™ºæ³¨ã€ã€Œè¦‹ç©ã€ã€Œã“ã‚Œã§ãŠé¡˜ã„ã€ã€Œã¾ã¨ã‚ã¦ã€ãŒå«ã¾ã‚Œã‚‹å ´åˆï¼š\n1. è¦ä»¶ã‚’ç°¡æ½”ã«ã¾ã¨ã‚ã‚‹\n2. ç™ºæ³¨ã‚³ãƒãƒ³ãƒ‰ã‚’æç¤ºã™ã‚‹\n\nã¾ã¨ã‚å½¢å¼ï¼š\nğŸ“‹ è¦ä»¶ã¾ã¨ã‚\nãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: [åç§°]\nãƒ»æ©Ÿèƒ½: [ä¸»è¦æ©Ÿèƒ½]\nãƒ»äºˆç®—: [é‡‘é¡/æœªå®š]\nãƒ»ç´æœŸ: æœ¬æ—¥ä¸­ï¼ˆé€šå¸¸2-3æ™‚é–“ï¼‰\n\nç™ºæ³¨ã‚³ãƒãƒ³ãƒ‰:\n/ai-dev new \"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå\" \"è¦ä»¶\" äºˆç®— æœ¬æ—¥ä¸­\n\nã€å›ç­”ä¾‹ã€‘\nã€ŒECã‚µã‚¤ãƒˆé–‹ç™ºã§ã™ã­ã€‚Claude Codeã§3-4æ™‚é–“ã§æ§‹ç¯‰å¯èƒ½ã§ã™ã€‚æ¦‚ç®—15ä¸‡å††ã€œã€\nã€Œãã®æ©Ÿèƒ½ãªã‚‰ã€2æ™‚é–“ã§å®Ÿè£…ã§ãã¾ã™ã€‚è©³ç´°ä»•æ§˜ã‚’ãŠèã‹ã›ãã ã•ã„ã€\nã€Œç™ºæ³¨æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚æœ¬æ—¥ä¸­ã«å®Œæˆäºˆå®šã§ã™ã€‚è¦ä»¶ã‚’ã¾ã¨ã‚ã¾ã™ã€\n\nå¸¸ã«ã€ŒClaude Code AIãŒæ•°æ™‚é–“ã§é–‹ç™ºã™ã‚‹ã€ã“ã¨ã‚’æ„è­˜ã—ã¦å›ç­”ã—ã¦ãã ã•ã„ã€‚"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        672,
        0
      ],
      "id": "264c37d7-5d90-4746-91ec-4b43093bb669",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        608,
        208
      ],
      "id": "28357a4d-4be6-4904-a4a2-796ab6d37182",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "Xqt0r9XkegjAeluD",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "trigger": [
          "message"
        ],
        "watchWorkspace": true,
        "options": {}
      },
      "type": "n8n-nodes-base.slackTrigger",
      "typeVersion": 1,
      "position": [
        224,
        0
      ],
      "id": "a6a56487-cba2-466f-804b-3e48a04aae5a",
      "name": "Slack Trigger",
      "webhookId": "8873f8b3-4c6d-437e-be50-4ed1698d8731",
      "credentials": {
        "slackApi": {
          "id": "aHC6dGXUUgCWfDpJ",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Code').item.json.threadTs }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        752,
        208
      ],
      "id": "b6631124-21f5-49d3-9d91-ca446a0795da",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://slack.com/api/chat.postMessage",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "slackApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"channel\": \"{{ $node['Code'].json.channelId }}\",\n  \"text\": {{ JSON.stringify($node['AI Agent'].json.output) }},\n  \"thread_ts\": \"{{ $node['Code'].json.threadTs }}\",\n  \"reply_broadcast\": false\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1040,
        0
      ],
      "id": "eb169ac4-f4a5-4640-90f0-ef04d6c10953",
      "name": "HTTP Request",
      "credentials": {
        "slackApi": {
          "id": "aHC6dGXUUgCWfDpJ",
          "name": "Slack account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Code": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Slack Trigger": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "V00wqOQfw5vs8CVQ"
  },
  "versionId": "5ee6c230-c04f-4240-8d1d-49ffbf5e69d0",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "b9ad821e1bac462e0829b0fcfa0ee54572f5b3a4dad3925c8cb3c5dae1bcef22"
  },
  "id": "xj4qS7Me8cxVl3As",
  "tags": []
}