{
  "name": "Github PRç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "github-pr-comments",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        0,
        0
      ],
      "id": "642d1ab5-80d6-4b19-925d-38cd8adb7e0e",
      "name": "Webhook",
      "webhookId": "d362f55e-24bd-4022-acca-cea756d29964"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Github PRç›£è¦–ã‚·ã‚¹ãƒ†ãƒ  - Codeãƒãƒ¼ãƒ‰ å®Œå…¨ãªä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰\n\n// PRã‚³ãƒ¡ãƒ³ãƒˆã®å†…å®¹ã‚’è§£æ\nconst eventType = $json.body.action; // created, edited, deleted\nconst comment = $json.body.comment?.body || '';\nconst prNumber = $json.body.issue?.number || $json.body.pull_request?.number;\nconst htmlUrl = $json.body.comment?.html_url || '';\nconst commenter = $json.body.comment?.user?.login || '';\nconst commentId = $json.body.comment?.id || null;\nconst prUrl = `https://github.com/${$json.body.repository?.full_name}/pull/${prNumber}`;\n\n// @claude-review-neededã‚¿ã‚°ã®æ¤œå‡º\nconst hasReviewTag = comment.includes('@claude-review-needed');\n\n// ãƒ•ã‚§ãƒ¼ã‚ºã®æ¤œå‡º\nconst phaseMatch = comment.match(/Phase (\\d)/);\nconst phase = phaseMatch ? phaseMatch[1] : null;\n\n// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Œäº†ãƒãƒ¼ã‚«ãƒ¼ã®æ¤œå‡º\nconst hasProjectCompleteMarker = comment.trim() === 'PROJECT COMPLETED';\n\n// é–‹ç™ºå®Œäº†åˆ¤å®š\nconst isProjectComplete = hasProjectCompleteMarker && commenter === 'claude[bot]';\n\n// ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦ã‹ã©ã†ã‹ã‚’åˆ¤å®š\nconst needsReview = hasReviewTag &&\n  !isProjectComplete &&  // å®Œäº†æ™‚ã¯ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸è¦\n  (eventType === 'created' ||\n   (eventType === 'edited' && comment.includes('Claude finished')));\n\n// é€šçŸ¥ã‚¿ã‚¤ãƒ—ã®åˆ¤å®š\nconst notificationType = isProjectComplete ? 'completion' :\n                        needsReview ? 'review' :\n                        'none';\n\nreturn {\n  json: {\n    notification_type: notificationType,\n    needs_review: needsReview,\n    is_completed: isProjectComplete,\n    pr_number: prNumber,\n    phase: phase,\n    comment: comment,\n    html_url: htmlUrl,\n    event_type: eventType,\n    commenter: commenter,\n    comment_id: commentId,\n    pr_url: prUrl,\n    has_phase4_marker: hasProjectCompleteMarker  // ãƒ‡ãƒãƒƒã‚°ç”¨\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        220,
        0
      ],
      "id": "98f6b085-3151-47af-9b44-4d8caddfd425",
      "name": "Code"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a884fec7-5b9a-47e9-bc70-03a66eb6f577",
              "leftValue": "={{ $json.notification_type }}",
              "rightValue": "none",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        440,
        0
      ],
      "id": "7e8e3f38-0146-446f-bb93-8e545120ab72",
      "name": "Filter"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.notification_type }}",
                    "rightValue": "review",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "95b31a38-65a1-4407-8f5d-289198fc7d6d"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "review"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "34d54dc6-61af-4930-a5b4-6ef1eaeabdc0",
                    "leftValue": "={{ $json.notification_type }}",
                    "rightValue": "completion",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "completion"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        660,
        0
      ],
      "id": "43fec369-d758-4f2e-926e-0c23cf51676b",
      "name": "Switch"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C094LNGF8H5",
          "mode": "id"
        },
        "messageType": "block",
        "blocksUi": "=   {\n     \"blocks\": [\n       {\n         \"type\": \"header\",\n         \"text\": {\n           \"type\": \"plain_text\",\n           \"text\": \"ğŸ”” ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦ã§ã™\"\n         }\n       },\n       {\n         \"type\": \"section\",\n         \"text\": {\n           \"type\": \"mrkdwn\",\n           \"text\": \"*PR #{{ $json.pr_number }}* ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦ã§ã™\\n*ãƒ•ã‚§ãƒ¼ã‚º*: Phase {{ $json.phase }}\\n*GitHub*: <{{ $json.html_url }}|ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèª>\"\n         }\n       },\n       {\n         \"type\": \"divider\"\n       },\n       {\n         \"type\": \"section\",\n         \"text\": {\n           \"type\": \"plain_text\",\n           \"text\": \"ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š\"\n         }\n       },\n       {\n         \"type\": \"actions\",\n         \"elements\": [\n           {\n             \"type\": \"button\",\n             \"text\": {\n               \"type\": \"plain_text\",\n               \"text\": \"âœ… æ‰¿èªã—ã¦ç¶šè¡Œ\"\n             },\n             \"style\": \"primary\",\n             \"value\": \"continue_{{ $json.pr_number }}\"\n           },\n           {\n             \"type\": \"button\",\n             \"text\": {\n               \"type\": \"plain_text\",\n               \"text\": \"ğŸ“ ä¿®æ­£ã‚’ä¾é ¼\"\n             },\n             \"value\": \"revise_{{ $json.pr_number }}\"\n           }\n         ]\n       }\n     ]\n   }",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        920,
        -120
      ],
      "id": "cf156cf2-fd7a-4edf-9b8f-8f7043da1cd6",
      "name": "Send a message - Review",
      "webhookId": "f7648295-fcd6-41fa-bb20-d942c1161b4d",
      "credentials": {
        "slackApi": {
          "id": "aHC6dGXUUgCWfDpJ",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C094LNGF8H5",
          "mode": "id"
        },
        "messageType": "block",
        "blocksUi": "=   {\n     \"blocks\": [\n       {\n         \"type\": \"header\",\n         \"text\": {\n           \"type\": \"plain_text\",\n           \"text\": \"ğŸ‰ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹ç™ºå®Œäº†\",\n           \"emoji\": true\n         }\n       },\n       {\n         \"type\": \"section\",\n         \"text\": {\n           \"type\": \"mrkdwn\",\n           \"text\": \"*Issue #{{ $json.pr_number }}* ã®é–‹ç™ºãŒå®Œäº†ã—ã¾ã—ãŸï¼\\n\\n*ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Œäº†*: ã€PROJECT COMPLETEDã€‘\\n*GitHub*: <{{ $json.html_url }}|å®Œäº†ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèª>\"\n         }\n       },\n       {\n         \"type\": \"divider\"\n       },\n       {\n         \"type\": \"section\",\n         \"text\": {\n           \"type\": \"mrkdwn\",\n           \"text\": \"âœ… å…¨ãƒ•ã‚§ãƒ¼ã‚ºãŒå®Œäº†ã—ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚\\nå®Ÿè£…å†…å®¹ã‚’ã”ç¢ºèªãã ã•ã„ã€‚\"\n         }\n       },\n       {\n         \"type\": \"actions\",\n         \"elements\": [\n           {\n             \"type\": \"button\",\n             \"text\": {\n               \"type\": \"plain_text\",\n               \"text\": \"ğŸ“‹ Issueã‚’ç¢ºèª\"\n             },\n             \"url\": \"https://github.com/nappa0326/ai-development-company/issues/{{ $json.pr_number }}\"\n           }\n         ]\n       }\n     ]\n   }",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        920,
        120
      ],
      "id": "697ebc3d-6c53-44d3-b3d1-bf897b9f4f4e",
      "name": "Send a message - Completion",
      "webhookId": "f7648295-fcd6-41fa-bb20-d942c1161b4d",
      "credentials": {
        "slackApi": {
          "id": "aHC6dGXUUgCWfDpJ",
          "name": "Slack account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Send a message - Review",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a message - Completion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "V00wqOQfw5vs8CVQ"
  },
  "versionId": "29ec3b95-1a82-479a-8a23-6c74bf59f4b2",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "b9ad821e1bac462e0829b0fcfa0ee54572f5b3a4dad3925c8cb3c5dae1bcef22"
  },
  "id": "9u9VFiVmuUAciUtW",
  "tags": []
}